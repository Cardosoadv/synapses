document.addEventListener("DOMContentLoaded",function(){function e(e,o="info"){const s=document.createElement("div");s.className=`message ${o}`,s.textContent=e,d.appendChild(s),d.scrollTop=d.scrollHeight}function o(e){try{const o=new URL(e),s=o.searchParams.get("numeroProcesso");return s?`${s}`:e}catch(o){return console.warn("Não foi possível formatar a URL para exibição:",o),e}}function s(s,r){return fetch(`${AppConfig.baseUrl}intimacoes/processarIntimacoes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(e=>{if(!e.ok)throw new Error(`Erro no processamento no servidor: ${e.status} ${e.statusText}`);return e.json()}).then(s=>{console.log("Resposta do servidor:",s);const n=o(r);if(!s.success)throw new Error(s.message||"Erro desconhecido no processamento");return e(`✓ Sucesso para ${n}: ${s.message} (Processadas: ${s.processadas})`,"success"),s.erros&&s.erros.length>0&&e(`↳ Erros no processamento: ${s.erros.length}`,"error"),s})}function r(r){const n=o(r);return e(`Buscando intimações de: ${n}...`,"info"),fetch(r).then(e=>{if(!e.ok)throw new Error(`Erro na busca (API externa): ${e.status} ${e.statusText}`);return e.json()}).then(o=>(console.log("Dados recebidos da API:",o),o.items&&0!==o.items.length?(e(`↳ ${o.items.length} intimações recebidas de ${n}. Processando...`,"info"),s(o,r)):(e(`↳ Nenhum item encontrado para ${n}.`,"info"),{success:!0,message:"Nenhum item",processadas:0,erros:[]})))}async function n(){if(i.style.display="block",d.innerHTML="",0===a.length)return e("Nenhuma URL de processo para processar.","info"),void(i.style.display="none");e(`Iniciando processamento de ${a.length} URL(s)...`,"info");let s=0,n=0;for(const n of a)try{await r(n),s++}catch(s){console.error(`Erro ao processar ${n}:`,s);const r=o(n);e(`✗ Falha total ao processar ${r}: ${s.message}`,"error")}i.style.display="none",e("-----------------------------------","info"),e("Processamento concluído.","info"),e(`Total de URLs com sucesso: ${s}`,"success"),e(`Total de URLs com falha: ${n}`,"error")}const t=document.getElementById("receiver-data");if(!t)return void console.error("Elemento #receiver-data não encontrado.");const a=JSON.parse(t.getAttribute("data-urls")||"[]"),c=AppConfig.baseUrl,i=document.getElementById("loader"),d=document.getElementById("messages");c?n():e("URL base (AppConfig.baseUrl) não configurada.","error")});