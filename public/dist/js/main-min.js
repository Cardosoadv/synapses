const formatDate=e=>{if(!e)return"Data não disponível";return new Date(e).toLocaleDateString("pt-BR")},truncateText=(e,t=80)=>e?e.length>t?e.substring(0,t)+"...":e:"",renderStatistics=e=>`\n                <div class="row text-center g-3">\n                    <div class="col-6">\n                        <div class="stat-box">\n                            <h3 class="mb-0 text-primary">${e.total||0}</h3>\n                            <small class="text-muted">Total</small>\n                        </div>\n                    </div>\n                    <div class="col-6">\n                        <div class="stat-box">\n                            <h3 class="mb-0 text-info">${e.com_repercussao_geral||0}</h3>\n                            <small class="text-muted">Rep. Geral</small>\n                        </div>\n                    </div>\n                    <div class="col-12">\n                        <div class="stat-box">\n                            <h3 class="mb-0 text-success">${e.com_recurso_repetitivo||0}</h3>\n                            <small class="text-muted">Rec. Repetitivo</small>\n                        </div>\n                    </div>\n                </div>\n            `,renderJurisprudenciaItem=e=>{const t=[];return e.repercussao_geral&&t.push('<span class="badge bg-primary">RG</span>'),e.recurso_repetitivo&&t.push('<span class="badge bg-info">RR</span>'),`\n                <a href="${AppConfig.baseUrl}jurisprudencias/consultarJurisprudencia/${e.id}" \n                    class="list-group-item list-group-item-action">\n                    <div class="d-flex w-100 justify-content-between align-items-start">\n                        <div class="flex-grow-1">\n                            <small class="text-primary fw-bold">${e.numero_processo}</small>\n                            ${t.length>0?'<div class="mt-1">'+t.join(" ")+"</div>":""}\n                        </div>\n                        ${e.relevancia_score>0?`<span class="badge bg-warning text-dark ms-2">${e.relevancia_score}</span>`:""}\n                    </div>\n                    ${e.tema?`<small class="text-muted d-block mt-1">Tema: ${e.tema}</small>`:""}\n                </a>\n            `};async function fetchEstatisticas(){try{const e=await fetch(`${AppConfig.baseUrl}jurisprudencias/estatisticas`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json(),s=document.getElementById("estatisticas");if(!t.success||!t.data)throw new Error("Dados inválidos");s.innerHTML=renderStatistics(t.data)}catch(e){handleFetchError(e,"estatisticas","Erro ao carregar estatísticas")}}async function fetchMaisRelevantes(){try{const e=await fetch(`${AppConfig.baseUrl}jurisprudencias/maisRelevantes/5`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json(),s=document.getElementById("maisRelevantes");t.success&&Array.isArray(t.data)&&t.data.length>0?s.innerHTML=t.data.map(renderJurisprudenciaItem).join(""):s.innerHTML='<div class="list-group-item text-muted">Nenhuma jurisprudência encontrada</div>'}catch(e){handleFetchError(e,"maisRelevantes","Erro ao carregar jurisprudências")}}async function fetchMaisRecentes(){try{const e=await fetch(`${AppConfig.baseUrl}jurisprudencias/maisRecentes/5`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json(),s=document.getElementById("maisRecentes");t.success&&Array.isArray(t.data)&&t.data.length>0?s.innerHTML=t.data.map(renderJurisprudenciaItem).join(""):s.innerHTML='<div class="list-group-item text-muted">Nenhuma jurisprudência encontrada</div>'}catch(e){handleFetchError(e,"maisRecentes","Erro ao carregar jurisprudências")}}const createProcessLink=e=>`${AppConfig.baseUrl}processos/editarpornumerodeprocesso/${e}`,handleFetchError=(e,t,s="Erro ao carregar informações")=>{const a=document.getElementById(t);a&&(a.innerHTML=`\n                    <div class="alert alert-danger mb-0">\n                        <i class="bi bi-exclamation-triangle"></i> ${s}\n                    </div>\n                `)},renderProcessItem=e=>`\n            <a href="${createProcessLink(e.numero_processo)}" \n               class="list-group-item list-group-item-action">\n                <div class="d-flex w-100 justify-content-between align-items-start">\n                    <div class="flex-grow-1">\n                        <small class="text-primary fw-bold">${e.numero_processo}</small>\n                        ${e.nome?`<p class="mb-0 text-muted small">${e.nome}</p>`:""}\n                    </div>\n                </div>\n                <small class="text-muted">Data: ${formatDate(e.dataHora)}</small>\n            </a>\n        `,renderIntimacaoItem=e=>`\n            <a href="${createProcessLink(e.numero_processo)}" \n               class="list-group-item list-group-item-action">\n                <div class="d-flex w-100 justify-content-between align-items-start">\n                    <div class="flex-grow-1">\n                        <small class="text-primary fw-bold">${e.numero_processo}</small>\n                        ${e.tipoComunicacao?`<p class="mb-0 text-muted small">${e.tipoComunicacao}</p>`:""}\n                    </div>\n                </div>\n                <small class="text-muted">Data: ${formatDate(e.data_disponibilizacao)}</small>\n            </a>\n        `;async function fetchProcessos(){try{const e=await fetch(`${AppConfig.baseUrl}processos/processosmovimentados/30`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json(),s=document.getElementById("processoMovimentados");Array.isArray(t)&&t.length>0?s.innerHTML=t.map(renderProcessItem).join(""):s.innerHTML='<div class="list-group-item text-muted">Nenhum processo encontrado</div>'}catch(e){handleFetchError(e,"processoMovimentados","Erro ao carregar processos")}}async function fetchIntimacoes(){try{const e=await fetch(`${AppConfig.baseUrl}intimacoes/intimacoesporperiodo/30`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json(),s=document.getElementById("intimacoes");Array.isArray(t)&&t.length>0?s.innerHTML=t.map(renderIntimacaoItem).join(""):s.innerHTML='<div class="list-group-item text-muted">Nenhuma intimação encontrada</div>'}catch(e){handleFetchError(e,"intimacoes","Erro ao carregar intimações")}}const selectAll=document.getElementById("selectAll"),processCheckboxes=document.querySelectorAll(".processCheckbox");function excluirEmLote(){const e=document.getElementById("processosForm"),t=document.querySelectorAll(".processCheckbox:checked");0!==t.length?confirm(`Tem certeza que deseja excluir ${t.length} processo(s) selecionado(s)?`)&&(e.action=`${AppConfig.baseUrl}processos/excluirEmLote`,e.submit()):alert("Selecione pelo menos um processo para excluir.")}selectAll.addEventListener("change",(function(){processCheckboxes.forEach((e=>{e.checked=this.checked}))}));const renderContratoItem=e=>`\n                <a href="${AppConfig.baseUrl}contratos/editar/${e.id_contrato}" \n                   class="list-group-item list-group-item-action">\n                    <small class="text-primary fw-bold">ID: ${e.id_contrato}</small>\n                    <p class="mb-1 small">${e.cliente_nome||"Cliente Desconhecido"}</p>\n                    <small class="text-muted d-block mt-1">\n                        <i class="bi bi-calendar-x"></i> Vencimento: ${formatDate(e.data_fim)}\n                    </small>\n                </a>\n            `;async function fetchEstatisticasContratos(){try{const e=await fetch(`${AppConfig.baseUrl}contratos/estatisticas`);let t={};e.ok&&(t=await e.json());const s=document.getElementById("estatisticasContratos");if(!t.data)throw new Error("Dados inválidos");s.innerHTML=renderStatistics(t.data)}catch(e){handleFetchError(e,"estatisticasContratos","Não foi possível carregar as estatísticas.")}}async function fetchContratosAVencer(){try{const e=await fetch(`${AppConfig.baseUrl}contratos/proximosAVencer/5`);let t={};if(e.ok)t=await e.json();else{const e=[];e.length>0?t.data=e.slice(0,3).map(((e,t)=>({...e,data_fim:new Date((new Date).setDate((new Date).getDate()+5*t)).toISOString().split("T")[0]}))):t.data=[]}const s=document.getElementById("contratosAVencer"),a=t.data||[];a.length>0?s.innerHTML=a.map(renderContratoItem).join(""):s.innerHTML='<div class="list-group-item text-muted">Nenhum contrato próximo de vencer.</div>'}catch(e){handleFetchError(e,"contratosAVencer","Não foi possível carregar os contratos.")}}