document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("receiver-data");if(!e)return;const o=e.getAttribute("data-url-movimento"),t=e.getAttribute("data-atualizar-intimacao"),r=e.getAttribute("data-api-key"),s=e.getAttribute("data-numero-processo");if(!o||""===o.trim())return;function n(e){try{const o=new URL(e).searchParams.get("numeroProcesso");return o?`${o}`:e}catch(o){return e}}function a(e){const o=n(e);return mostrarMensagem(`Buscando movimentos de: ${o}...`,"info"),function(e,o,t){return fetch(e,{method:"POST",headers:{Authorization:o,"Content-Type":"application/json","x-li-format":"json","User-Agent":"insomnia/10.1.1"},body:JSON.stringify({query:{match:{numeroProcesso:t}}})}).then((e=>{if(!e.ok)throw new Error(`Erro na busca (API DataJud): ${e.status} ${e.statusText}`);return e.json()})).then((e=>e))}(e,r,s).then((t=>t.items&&0!==t.items.length?(mostrarMensagem(`↳ ${t.items.length} movimentos recebidos de ${o}. Processando...`,"info"),function(e,o){return fetch(`${AppConfig.baseUrl}movimentos/processarMovimentosDatajud`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(!e.ok)throw new Error(`Erro no processamento no servidor: ${e.status} ${e.statusText}`);return e.json()})).then((e=>{const t=n(o);if(!e.success)throw new Error(e.message||"Erro desconhecido no processamento");return mostrarMensagem(`✓ Sucesso para ${t}: ${e.message} (Processadas: ${e.processadas})`,"success"),e.erros&&e.erros.length>0&&mostrarMensagem(`↳ Erros no processamento: ${e.erros.length}`,"error"),e}))}(t,e)):(mostrarMensagem(`↳ Nenhum item encontrado para ${o}.`,"info"),{success:!0,message:"Nenhum item",processadas:0,erros:[]})))}AppConfig.baseUrl?async function(){if(!1===t||"false"===t)return void mostrarMensagem("Movimentos já atualizados.","info");mostrarMensagem("Iniciando processamento dos Movimentos...","info");try{await a(o)}catch(e){const t=n(o);mostrarMensagem(`✗ Falha total ao processar ${t}: ${e.message}`,"error")}mostrarMensagem("Processamento de intimações concluído.","info")}():mostrarMensagem("URL base (AppConfig.baseUrl) não configurada.","error")}));