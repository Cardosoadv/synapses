document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("receiver-data");if(!e)return;const s=e.getAttribute("data-url-intimacao"),r=e.getAttribute("data-atualizar-intimacao");if(!s||""===s.trim())return;function t(e){try{const s=new URL(e).searchParams.get("numeroProcesso");return s?`${s}`:e}catch(s){return e}}function a(e){const s=t(e);return mostrarMensagem(`Buscando intimações de: ${s}...`,"info"),fetch(e).then((e=>{if(!e.ok)throw new Error(`Erro na busca (API externa): ${e.status} ${e.statusText}`);return e.json()})).then((r=>r.items&&0!==r.items.length?(mostrarMensagem(`↳ ${r.items.length} intimações recebidas de ${s}. Processando...`,"info"),function(e,s){return fetch(`${AppConfig.baseUrl}intimacoes/processarIntimacoes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(!e.ok)throw new Error(`Erro no processamento no servidor: ${e.status} ${e.statusText}`);return e.json()})).then((e=>{const r=t(s);if(!e.success)throw new Error(e.message||"Erro desconhecido no processamento");return mostrarMensagem(`✓ Sucesso para ${r}: ${e.message} (Processadas: ${e.processadas} | Novas: ${e.novas} | Repetidas: ${e.repetidas})`,"success"),e.erros&&e.erros.length>0&&mostrarMensagem(`↳ Erros no processamento: ${e.erros.length}`,"error"),e}))}(r,e)):(mostrarMensagem(`↳ Nenhum item encontrado para ${s}.`,"info"),{success:!0,message:"Nenhum item",processadas:0,erros:[]})))}AppConfig.baseUrl?async function(){if(!1===r||"false"===r)return void mostrarMensagem("Intimações já atualizadas.","info");mostrarMensagem("Iniciando processamento das Intimações...","info");try{await a(s)}catch(e){const r=t(s);mostrarMensagem(`✗ Falha total ao processar ${r}: ${e.message}`,"error")}mostrarMensagem("Processamento de intimações concluído.","info")}():mostrarMensagem("URL base (AppConfig.baseUrl) não configurada.","error")}));