document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("receiver-data");if(!e)return;const s=JSON.parse(e.getAttribute("data-urls")||"[]"),o=AppConfig.baseUrl,n=document.getElementById("loader"),t=document.getElementById("messages");function r(e,s="info"){const o=document.createElement("div");o.className=`message ${s}`,o.textContent=e,t.appendChild(o),t.scrollTop=t.scrollHeight}function a(e){try{const s=new URL(e),o=s.searchParams.get("numeroOab"),n=s.searchParams.get("ufOab");return o&&n?`${o}/${n}`:e}catch(s){return e}}function c(e){const s=a(e);return r(`Buscando intimações de: ${s}...`,"info"),fetch(e).then((e=>{if(!e.ok)throw new Error(`Erro na busca (API externa): ${e.status} ${e.statusText}`);return e.json()})).then((o=>o.items&&0!==o.items.length?(r(`↳ ${o.items.length} intimações recebidas de ${s}. Processando...`,"info"),function(e,s){return fetch(`${AppConfig.baseUrl}intimacoes/processarIntimacoes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(!e.ok)throw new Error(`Erro no processamento no servidor: ${e.status} ${e.statusText}`);return e.json()})).then((e=>{const o=a(s);if(!e.success)throw new Error(e.message||"Erro desconhecido no processamento");return r(`✓ Sucesso para ${o}: ${e.message} (Processadas: ${e.processadas} | Novas: ${e.novas} | Repetidas: ${e.repetidas})`,"success"),e.erros&&e.erros.length>0&&r(`↳ Erros no processamento: ${e.erros.length}`,"error"),e}))}(o,e)):(r(`↳ Nenhum item encontrado para ${s}.`,"info"),{success:!0,message:"Nenhum item",processadas:0,erros:[]})))}o?async function(){if(n.style.display="block",t.innerHTML="",0===s.length)return r("Nenhuma URL de advogado para processar.","info"),void(n.style.display="none");r(`Iniciando processamento de ${s.length} URL(s)...`,"info");let e=0,l=0;for(const o of s)try{await c(o),e++}catch(e){r(`✗ Falha total ao processar ${a(o)}: ${e.message}`,"error"),l++}n.style.display="none",r("-----------------------------------","info"),r("Processamento concluído.","info"),r(`Total de URLs com sucesso: ${e}`,"success"),r(`Total de URLs com falha: ${l}`,"error")}():r("URL base (AppConfig.baseUrl) não configurada.","error")}));